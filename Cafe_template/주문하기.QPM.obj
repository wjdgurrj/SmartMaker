0

#SCRIPT_EDIT_SOURCE
폼을 열면 다음 문단을 실행한다.
{
        부모폼을 종료한다.
        회원ID는 전역정보("회원ID")를 참조한다.
        파라미터는 식("전달값" + "$" + 1)을 참조한다.
        //완료의 화면감춤을 설정한다.
        DB처리문("회원정보찾기")를 실행한다.
        DB처리문("포인트찾아오기")를 실행한다.
        만일 임시처리상태가 "장바구니"이면 다음 문단을 실행한다.
        {        
                스크롤의 기본조건을 식("회원ID = '"+회원ID+"'" + "AND 처리상태 = '결제전'")으로 설정한다.
        }
        만일 임시처리상태가 "바로주문"이면 다음 문단을 실행한다.
        {
                스크롤의 기본조건을 식("회원ID = '"+회원ID+"'" + "AND 처리상태 = '바로주문'")으로 설정한다.
        }
        폼의 기본검색키동작을 실행한다.
        임시총가격은 총가격을 참조한다.
}

버튼_닫기을 누르면 다음 문단을 실행한다.
{
        "결제 및 주문을 취소하시겠습니까?"를 화면에 표시한다.('예아니오','질문',"","예처리","아니오처리")
}

문단 예처리
{
                만일 임시처리상태가 "바로주문"이면 다음 문단을 실행한다.
                {
                        DB처리문("바로주문취소")을 실행한다.
                }
                만일 임시처리상태가 "장바구니"이면 다음 문단을 실행한다.
                {
                        DB처리문("결제전주문취소")를 실행한다.
                }
                버튼의 닫기를 실행한다.
}

PG결제의 결제를 성공하면 다음 문단을 실행한다.(상품아이디)
{
        "결제가 완료되었습니다. 완료 버튼을 꼭 눌러주십시오"를 화면에 표시한다.
      
        완료의 화면감춤을 해제한다.
        
}

PG결제의 결제를 실패하면 다음 문단을 실행한다.(실패이유)
{
        
}

결제및주문하기을 누르면 다음 문단을 실행한다.
{
        만일 식(사용할포인트+총가격)이 임시총가격이 아니면 다음 문단을 실행한다.
        {
                "포인트를 다시 입력해주세요"를 화면에 표시한다.
                문단의 실행을 종료한다.
        }
        PG결제의 PG결제요청을 실행한다.
}

포인트사용버튼을 누르면 다음 문단을 실행한다.
{
        만일 사용할포인트가 보유적립금보다 크면 다음 문단을 실행한다.
        {
                "보유적립금보다 많이 사용할 수 없습니다"를 화면에 표시한다.
                사용할포인트는 보유적립금을 참조한다.
                //문단의 실행을 종료한다.        
        }
        만일 사용할포인트가 총가격보다 크면 다음 문단을 실행한다.
        {
                "총 결제금액보다 많이 사용할 수 없습니다."를 화면에 표시한다.
                사용할포인트는 0을 참조한다.
        }
        총가격은 식(임시총가격-사용할포인트)를 참조한다.
}

완료을 누르면 다음 문단을 실행한다.
{        
        
        임시갯수는 스크롤의 유효행수를 참조한다.
        임시갯수는 식(임시갯수-1)을 참조한다.
        만일 임시갯수가 0이면 임시메뉴명은 메뉴명[1]을 참조한다.
        만일 임시갯수가 0이 아니면 임시메뉴명은 식(메뉴명[1]+" 외"+임시갯수)을 참조한다.
        관리등록번호의 기본검색키동작을 실행한다.
        포인트차감양은 식(보유적립금-사용할포인트)를 참조한다.
        DB처리문("포인트차감하기")를 실행한다.
        결제완료는 "결제완료"를 참조한다.
        DB처리문("결제완료처리하기")를 실행한다.
        DB처리문("주문앱_관리저장하기")를 실행한다.
        "주문이 완료되었습니다"를 알림으로 표시한다.
        통합메시지의 메시지전송을 실행한다.
        // 카페_가게 앱에 Push 메시지 전송해야함
        // Push 메시지를 받은 카페_가게앱은 알림이 뜨고 검색창의 검색을 다시 해야함
        //버튼의 닫기를 실행한다.
        완료닫기버튼의 화면감춤을 해제한다.
        완료가리개의 화면감춤을 해제한다.
}

폼을 닫으면 다음 문단을 실행한다.
{
        만일 임시처리상태가 "바로주문"이면 다음 문단을 실행한다.
                {
                        DB처리문("바로주문취소")을 실행한다.
                }
        만일 임시처리상태가 "장바구니"이면 다음 문단을 실행한다.
                {
                        DB처리문("결제전주문취소")를 실행한다.
                }
}



완료닫기버튼을 누르면 다음 문단을 실행한다.
{
        버튼의 닫기를 실행한다.
}